name: sam3-project

services:
  sam3-app:
    image: sam3:base
    build:
      context: .
      dockerfile: Dockerfile.sam3
    container_name: test-container
    working_dir: /app
    
    # GPU config
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    # Volume mount
    volumes:
      - ./test_scripts:/app/test_scripts
      # - ./sam3:/app/sam3
      - ./huggingface_cache:/root/.cache/huggingface
    
    # Keep container running interactively
    tty: true
    stdin_open: true
    
    # Pass environment variable for Python safety
    environment:
      - PIP_BREAK_SYSTEM_PACKAGES=1
      - PYTHONUNBUFFERED=1

    # command: python3 /app/test_scripts/run_sam3.py
